import{a as p}from"./chunk-HULGCXHD.js";import{a as g}from"./chunk-JMTCKGXD.js";import{c as l}from"./chunk-BLPDBI5E.js";import{M as a,R as o,X as h,ab as u,j as e}from"./chunk-RY22DRUR.js";var O=(()=>{let s=class s{constructor(){this.apiUrl=g.apiUrl+"cart",this.http=h(l),this.userService=h(p),this.user=this.userService.user,this.cartSignal=u(null),this.cartTotal=u(null),this.guestCart={cartItems:[]},this.STORAGE_KEY="hd30jlsncjefysakhs",this.CART_KEY="sjshdy382nsj02shk02s";let t=JSON.parse(localStorage.getItem(this.STORAGE_KEY));t&&(this.guestCart=t);let r=JSON.parse(localStorage.getItem(this.CART_KEY));r&&(this.cartSignal.set(r),this.cartTotal.set(r.cartItems.length))}getCart(){return this.user()?this.cartSignal()?e(this.cartSignal()):this.http.get(`${this.apiUrl}/${this.user()?.id}`).pipe(a(t=>{this.cartSignal.set(t),this.cartTotal.set(t.cartItems.length),this.mergeCart()?.subscribe(),localStorage.setItem(this.CART_KEY,JSON.stringify(t))})):(this.cartTotal.set(this.guestCart.cartItems.length),this.cartSignal.set(this.guestCart),e(this.guestCart))}addToCart(t){if(this.user())return this.http.post(`${this.apiUrl}/add`,{userId:this.user()?.id,unit:t.unit,productId:t.product.id,productPrice:t.product.price});{let r={total:t.product.price*t.unit,unit:t.unit,shippingCost:100,product:t.product,id:this.generateRandomId(),productId:t.product.id};return this.guestCart.cartItems?.push(r),this.cartSignal.set(this.guestCart),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.guestCart)),e(this.guestCart)}}updateCartItem(t){return this.user()?this.http.patch(`${this.apiUrl}/${t.itemId}/update`,{unit:t.unit,productPrice:t.productPrice}):(this.guestCart.cartItems=this.guestCart.cartItems?.map(r=>(r.id==t.itemId&&(r.unit=t.unit,r.total=t.unit*r.product.price),r)),this.cartSignal.set(this.guestCart),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.guestCart)),e(this.guestCart))}deleteCartItem(t){return this.user()?this.http.delete(`${this.apiUrl}/${t}/delete`):(this.guestCart.cartItems=this.guestCart.cartItems?.filter(r=>r.id!==t),this.cartSignal.set(this.guestCart),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.guestCart)),e(this.guestCart))}mergeCart(){if(this.guestCart.cartItems?.length)return this.http.post(`${this.apiUrl}/${this.user()?.id}/merge`,this.guestCart).pipe(a(t=>{localStorage.removeItem(this.STORAGE_KEY),this.cartSignal.set(t),this.cartTotal.set(t.cartItems.length)}))}generateRandomId(t=10){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c="";for(let n=0;n<t;n++){let m=Math.floor(Math.random()*r.length);c+=r[m]}return c}};s.\u0275fac=function(r){return new(r||s)},s.\u0275prov=o({token:s,factory:s.\u0275fac,providedIn:"root"});let i=s;return i})();export{O as a};
